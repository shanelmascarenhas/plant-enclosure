<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Plant Info</title>
    <style>
      :root{ --bg: #0b0f0c; --card: rgba(255,255,255,0.06); --card2: rgba(255,255,255,0.10); --text: rgba(255,255,255,0.92); --muted: rgba(255,255,255,0.72); --stroke: rgba(255,255,255,0.12); --shadow: 0 18px 60px rgba(0,0,0,0.45); --radius: 18px; }
      * { box-sizing: border-box; }
      
      body{ 
        margin:0; font-family: system-ui, sans-serif; color: var(--text); 
        background: radial-gradient(1200px 800px at 20% 10%, rgba(44, 255, 138, 0.15), transparent 55%), #0b0f0c; 
        min-height: 100vh; display:flex; align-items:center; justify-content:center; padding: 22px;
        overflow-x: hidden;
      }

      /* Animation for entry */
      @keyframes pageIn {
        from { opacity: 0; transform: translateY(20px) scale(0.98); filter: blur(10px); }
        to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
      }

      .wrap{ 
        width: min(980px, 100%); 
        display:grid; 
        grid-template-columns: 1.15fr 0.85fr; 
        gap: 18px; 
        animation: pageIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        transition: transform 0.5s ease, opacity 0.4s ease, filter 0.4s ease;
      }

      /* Transition classes for navigating */
      .slide-out-left { transform: translateX(-100px); opacity: 0; filter: blur(10px); }
      .slide-out-right { transform: translateX(100px); opacity: 0; filter: blur(10px); }

      @media (max-width: 820px){ .wrap{ grid-template-columns: 1fr; } }
      .card{ background: var(--card); border: 1px solid var(--stroke); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; backdrop-filter: blur(10px); }
      .hero{ position: relative; height: 300px; background: #111; }
      .hero img{ width: 100%; height: 100%; object-fit: cover; display:block; filter: saturate(1.1); }
      .hero::after{ content:""; position:absolute; inset:0; background: linear-gradient(180deg, rgba(0,0,0,0.1), rgba(0,0,0,0.8)); pointer-events:none; }
      .topline{ position:absolute; left: 16px; right: 16px; bottom: 14px; display:flex; justify-content:space-between; align-items:flex-end; z-index: 2; }
      .titleblock h1{ margin:0; font-size: 28px; line-height: 1.15; }
      .titleblock p{ margin: 6px 0 0; color: var(--muted); font-size: 14px; }
      .content{ padding: 16px; }
      .grid{ display:grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 12px; }
      @media (max-width: 520px){ .grid{ grid-template-columns: 1fr 1fr; } }
      .mini{ background: var(--card2); border: 1px solid var(--stroke); border-radius: 14px; padding: 12px; text-align: center; }
      .mini .k{ color: var(--muted); font-size: 11px; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
      .mini .v{ font-size: 14px; font-weight: bold; }
      .sectionTitle{ margin: 18px 0 8px; font-weight: 700; }
      .chips{ display:flex; flex-wrap:wrap; gap: 8px; }
      .chip{ padding: 6px 12px; border-radius: 99px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.08); font-size: 13px; }
      
      .actions{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
      .btn{ appearance: none; border: 1px solid rgba(255,255,255,0.16); background: rgba(255,255,255,0.08); color: var(--text); padding: 14px; border-radius: 12px; font-weight: 650; font-size: 14px; cursor: pointer; display:inline-flex; align-items:center; justify-content: center; gap: 8px; text-decoration: none; text-align: center; transition: 0.2s;}
      .btn:hover{ background: rgba(255,255,255,0.15); }
      .btnSend { background: rgba(79, 153, 255, 0.2); border-color: rgba(79, 153, 255, 0.4); grid-column: span 2; }
      .btnSend:hover { background: rgba(79, 153, 255, 0.3); }
      .btnBuy { background: rgba(44, 255, 138, 0.16); border-color: rgba(44, 255, 138, 0.28); }
      .btnBuy:hover { background: rgba(44, 255, 138, 0.22); }
      
      .side{ padding: 20px; }
      .side h2{ margin: 0 0 10px; font-size: 18px; }
      .list{ padding-left: 20px; color: rgba(255,255,255,0.85); line-height: 1.6; font-size: 14px; }
      .back-link { position: absolute; top: 20px; left: 20px; z-index: 10; background: rgba(0,0,0,0.5); padding: 8px 12px; border-radius: 8px; color: white; text-decoration: none; font-size: 12px; backdrop-filter: blur(4px); }
      #statusMsg { grid-column: span 2; text-align: center; font-size: 12px; margin-top: 5px; color: var(--muted); height: 16px; }

      /* NEXT / PREV BUTTONS BAR */
      .nav-bar {
        grid-column: span 2;
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        gap: 15px;
      }
      .nav-btn {
        flex: 1;
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--stroke);
        color: var(--muted);
        padding: 12px;
        border-radius: 14px;
        cursor: pointer;
        text-decoration: none;
        text-align: center;
        font-size: 13px;
        font-weight: 600;
        transition: 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .nav-btn:hover { background: rgba(255,255,255,0.08); color: white; border-color: var(--muted); }
    </style>
  </head>
  <body>
    <div class="wrap" id="mainWrap">
      <div class="card">
        <div class="hero">
          <a href="list.html" class="back-link">‚Üê Back to List</a>
          <img id="plantImg" alt="Plant photo" src="" />
          <div class="topline">
            <div class="titleblock">
              <h1 id="plantName">Plant Name</h1>
              <p id="plantSubtitle">Scientific Name</p>
            </div>
          </div>
        </div>

        <div class="content">
          <div class="grid">
            <div class="mini"><div class="k">üåû Light</div><div class="v" id="light">‚Äî</div></div>
            <div class="mini"><div class="k">üíß Water</div><div class="v" id="water">‚Äî</div></div>
            <div class="mini"><div class="k">üå°Ô∏è Temp</div><div class="v" id="temp">‚Äî</div></div>
            <div class="mini"><div class="k">‚òÅÔ∏è Humidity</div><div class="v" id="humidity">‚Äî</div></div>
          </div>
          <div class="sectionTitle">Care tips</div>
          <div class="chips" id="tipsChips"></div>

          <div class="actions">
            <button class="btn btnSend" id="sendBtn">üì° Send to Enclosure</button>
            <div id="statusMsg"></div>
            <a href="#" class="btn btnBuy" id="buyBtn" target="_blank">üõí Buy Plant</a>
            <button class="btn" id="saveBtn">üíö Save</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="side">
          <h2>Quick guide</h2>
          <ul class="list" id="quickGuide"></ul>
          <div style="margin-top:20px; font-size:12px; color:var(--muted); border-top:1px solid var(--stroke); padding-top:10px;">
            Enclosure Settings Preview:<br>
            <span id="debugSettings" style="font-family:monospace; color:#4f99ff;"></span>
          </div>
        </div>
      </div>

      <div class="nav-bar">
        <div id="prevBtn" class="nav-btn">‚Üê Previous Plant</div>
        <div id="nextBtn" class="nav-btn">Next Plant ‚Üí</div>
      </div>
    </div>

    <script>
      const FIREBASE_URL = "https://plant-enclosure-default-rtdb.firebaseio.com/settings.json"; 
      
      let ESP32_IP = "";
      try { ESP32_IP = localStorage.getItem("esp32_ip") || ""; } catch(e) { console.warn("Local storage disabled"); }
      if (ESP32_IP && !ESP32_IP.startsWith("http")) ESP32_IP = "http://" + ESP32_IP;
      
      const ESP32_SETTINGS_PATH = "/settings"; 

      const plants = {
        pothos: { name: "Pothos", subtitle: "Epipremnum aureum", img: "https://plus.unsplash.com/premium_photo-1663962975773-44cfbefe880b?auto=format&fit=crop&w=800&q=80", display: { temp: "65-85¬∞F", hum: "40-60%", light: "Low/Med", water: "Weekly" }, settings: { tempLow: 65.0, tempHigh: 85.0, humLow: 40.0, humHigh: 60.0, soilLow: 20, soilHigh: 50, timeOnHour: 9, timeOffHour: 19, luxThreshold: 5000 }, tips: ["Rotate weekly", "Wipe leaves", "Avoid harsh sun"], guide: ["Water when top 2cm is dry.", "Thrives in indirect light.", "Fertilize in Spring."], buyUrl: "https://www.amazon.com/s?k=pothos+plant" },
        snake: { name: "Snake Plant", subtitle: "Sansevieria", img: "https://images.unsplash.com/photo-1588709983192-3852c7713145?auto=format&fit=crop&w=800&q=80", display: { temp: "60-90¬∞F", hum: "30-50%", light: "Any", water: "2-3 Wks" }, settings: { tempLow: 60.0, tempHigh: 90.0, humLow: 30.0, humHigh: 50.0, soilLow: 10, soilHigh: 40, timeOnHour: 8, timeOffHour: 20, luxThreshold: 3000 }, tips: ["Don't overwater", "Wipe dust", "Hardy"], guide: ["Let soil dry completely.", "Tolerates low light.", "Use cactus soil."], buyUrl: "https://www.amazon.com/s?k=snake+plant" },
        monstera: { name: "Monstera", subtitle: "Monstera deliciosa", img: "https://images.unsplash.com/photo-1585598117002-9fb152e67dbf?auto=format&fit=crop&w=800&q=80", display: { temp: "68-86¬∞F", hum: "60-80%", light: "Bright", water: "1-2 Wks" }, settings: { tempLow: 68.0, tempHigh: 86.0, humLow: 60.0, humHigh: 80.0, soilLow: 40, soilHigh: 70, timeOnHour: 7, timeOffHour: 21, luxThreshold: 20000 }, tips: ["Needs support", "Mist leaves", "Filter sun"], guide: ["Keep soil moist but not wet.", "Likes humidity.", "Provide a moss pole."], buyUrl: "https://www.amazon.com/s?k=monstera+plant" },
        spider: { name: "Spider Plant", subtitle: "Chlorophytum comosum", img: "https://images.unsplash.com/photo-1664133980546-4e8e41ba06da?auto=format&fit=crop&w=800&q=80", display: { temp: "60-75¬∞F", hum: "40-60%", light: "Indirect", water: "Weekly" }, settings: { tempLow: 60.0, tempHigh: 75.0, humLow: 40.0, humHigh: 60.0, soilLow: 30, soilHigh: 60, timeOnHour: 8, timeOffHour: 20, luxThreshold: 10000 }, tips: ["Easy to propagate", "Brown tips = dry", "Fast grower"], guide: ["Water well, let drain.", "Avoid direct sun.", "Cut babies to grow new plants."], buyUrl: "https://www.amazon.com/s?k=spider+plant" },
        aloe: { name: "Aloe Vera", subtitle: "Aloe barbadensis", img: "https://images.unsplash.com/photo-1565964450731-27a34da777a1?auto=format&fit=crop&w=800&q=80", display: { temp: "55-80¬∞F", hum: "Dry", light: "Direct", water: "3 Wks" }, settings: { tempLow: 55.0, tempHigh: 80.0, humLow: 10.0, humHigh: 40.0, soilLow: 5, soilHigh: 30, timeOnHour: 7, timeOffHour: 19, luxThreshold: 40000 }, tips: ["Harvest gel", "Sun lover", "Sandy soil"], guide: ["Deep water, then dry out.", "Sunny windowsill.", "Medicinal gel inside leaves."], buyUrl: "https://www.amazon.com/s?k=aloe+vera+plant" },
        peace: { name: "Peace Lily", subtitle: "Spathiphyllum", img: "https://images.unsplash.com/photo-1593691509543-c55fb32d8de5?auto=format&fit=crop&w=800&q=80", display: { temp: "65-85¬∞F", hum: "50-70%", light: "Low/Med", water: "Weekly" }, settings: { tempLow: 65.0, tempHigh: 85.0, humLow: 50.0, humHigh: 70.0, soilLow: 30, soilHigh: 60, timeOnHour: 8, timeOffHour: 20, luxThreshold: 5000 }, tips: ["Leaves droop when thirsty", "Toxic to pets", "Likes humidity"], guide: ["Keep soil consistently moist.", "Wipe leaves to remove dust.", "Low light is perfectly fine."], buyUrl: "https://www.amazon.com/s?k=peace+lily" },
        zz: { name: "ZZ Plant", subtitle: "Zamioculcas zamiifolia", img: "https://images.unsplash.com/photo-1606256419855-d72ce8675863?auto=format&fit=crop&w=800&q=80", display: { temp: "65-85¬∞F", hum: "30-50%", light: "Low/Med", water: "2-3 Wks" }, settings: { tempLow: 65.0, tempHigh: 85.0, humLow: 30.0, humHigh: 50.0, soilLow: 10, soilHigh: 30, timeOnHour: 8, timeOffHour: 20, luxThreshold: 3000 }, tips: ["Thrives on neglect", "Drought tolerant", "Very slow grower"], guide: ["Let soil dry out completely.", "Can survive in windowless rooms.", "Don't overwater!"], buyUrl: "https://www.amazon.com/s?k=zz+plant" },
        fiddle: { name: "Fiddle Leaf Fig", subtitle: "Ficus lyrata", img: "https://images.unsplash.com/photo-1700409804286-64a4666a7f26?auto=format&fit=crop&w=800&q=80", display: { temp: "65-85¬∞F", hum: "40-60%", light: "Bright", water: "1-2 Wks" }, settings: { tempLow: 65.0, tempHigh: 85.0, humLow: 40.0, humHigh: 60.0, soilLow: 30, soilHigh: 60, timeOnHour: 7, timeOffHour: 21, luxThreshold: 25000 }, tips: ["Hates drafts", "Needs bright light", "Wipe big leaves"], guide: ["Water when top 2 inches are dry.", "Rotate the plant monthly.", "Do not move it often."], buyUrl: "https://www.amazon.com/s?k=fiddle+leaf+plant" },
        jade: { name: "Jade Plant", subtitle: "Crassula ovata", img: "https://plus.unsplash.com/premium_photo-1675802754634-3e0967bd3fab?auto=format&fit=crop&w=800&q=80", display: { temp: "65-85¬∞F", hum: "30-50%", light: "Bright", water: "2-3 Wks" }, settings: { tempLow: 65.0, tempHigh: 85.0, humLow: 30.0, humHigh: 50.0, soilLow: 10, soilHigh: 30, timeOnHour: 7, timeOffHour: 21, luxThreshold: 40000 }, tips: ["Money plant", "Easy to propagate", "Store water in leaves"], guide: ["Requires bright direct sunlight.", "Water thoroughly, then let dry.", "Can live for decades."], buyUrl: "https://www.amazon.com/s?k=jade+plant" },
        rubber: { name: "Rubber Plant", subtitle: "Ficus elastica", img: "https://images.unsplash.com/photo-1669392597221-bbfd4b6e13ff?auto=format&fit=crop&w=800&q=80", display: { temp: "65-85¬∞F", hum: "40-60%", light: "Bright/Med", water: "1-2 Wks" }, settings: { tempLow: 65.0, tempHigh: 85.0, humLow: 40.0, humHigh: 60.0, soilLow: 30, soilHigh: 50, timeOnHour: 8, timeOffHour: 20, luxThreshold: 20000 }, tips: ["Sap can irritate", "Wipe leaves", "Support when tall"], guide: ["Water when soil is dry to touch.", "Requires indirect bright light.", "Avoid cold drafts."], buyUrl: "https://www.amazon.com/s?k=rubber+plant" }
      };

      try {
          const params = new URLSearchParams(window.location.search);
          const plantId = (params.get("plant") || "pothos").toLowerCase();
          const p = plants[plantId] || plants.pothos;

          // Populate UI
          document.getElementById("plantName").textContent = p.name;
          document.getElementById("plantSubtitle").textContent = p.subtitle;
          document.getElementById("plantImg").src = p.img;
          document.getElementById("light").textContent = p.display.light;
          document.getElementById("water").textContent = p.display.water;
          document.getElementById("temp").textContent = p.display.temp;
          document.getElementById("humidity").textContent = p.display.hum;
          document.getElementById("buyBtn").href = p.buyUrl;
          document.getElementById("debugSettings").textContent = `T:${p.settings.tempLow}-${p.settings.tempHigh} H:${p.settings.humLow}-${p.settings.humHigh}`;

          const tipsContainer = document.getElementById("tipsChips");
          p.tips.forEach(t => { const d = document.createElement("div"); d.className="chip"; d.textContent="‚ú® " + t; tipsContainer.appendChild(d); });

          const guideContainer = document.getElementById("quickGuide");
          p.guide.forEach(g => { const li = document.createElement("li"); li.textContent = g; guideContainer.appendChild(li); });

          // --- CYCLING LOGIC ---
          const plantKeys = Object.keys(plants);
          const currentIndex = plantKeys.indexOf(plantId);
          
          const nextIndex = (currentIndex + 1) % plantKeys.length;
          const prevIndex = (currentIndex - 1 + plantKeys.length) % plantKeys.length;

          const wrap = document.getElementById("mainWrap");

          document.getElementById("nextBtn").addEventListener("click", () => {
             wrap.classList.add("slide-out-left"); // Slide away to the left
             setTimeout(() => {
                window.location.href = `plant.html?plant=${plantKeys[nextIndex]}`;
             }, 400);
          });

          document.getElementById("prevBtn").addEventListener("click", () => {
             wrap.classList.add("slide-out-right"); // Slide away to the right
             setTimeout(() => {
                window.location.href = `plant.html?plant=${plantKeys[prevIndex]}`;
             }, 400);
          });

          // --- SEND TO HARDWARE ---
          const sendBtn = document.getElementById("sendBtn");
          const status = document.getElementById("statusMsg");

          sendBtn.addEventListener("click", async () => {
            if (!ESP32_IP || ESP32_IP === "http://") { 
                let manualIp = prompt("Please enter your ESP32 IP Address (e.g. 192.168.1.100):");
                if (manualIp) {
                    try { localStorage.setItem("esp32_ip", manualIp); } catch(e) {}
                    ESP32_IP = manualIp.startsWith("http") ? manualIp : "http://" + manualIp;
                } else { return; }
            }

            sendBtn.disabled = true; sendBtn.textContent = "Sending..."; status.textContent = "Updating hardware...";

            try {
              const res = await fetch(`${ESP32_IP}${ESP32_SETTINGS_PATH}`, {
                method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(p.settings)
              });
              if (!res.ok) throw new Error("ESP32 not responding");

              status.textContent = "Syncing with cloud...";
              const fbRes = await fetch(FIREBASE_URL, {
                  method: "PATCH", headers: { "Content-Type": "application/json" }, body: JSON.stringify(p.settings)
              });
              if (!fbRes.ok) throw new Error("Firebase sync failed");

              status.textContent = "‚úÖ System updated!"; sendBtn.textContent = "Sent Successfully"; sendBtn.style.background = "#2cff8a"; sendBtn.style.color = "#000";
            } catch (err) {
              console.error(err); status.textContent = "‚ùå Error: " + err.message; sendBtn.textContent = "Retry"; sendBtn.disabled = false;
            }
          });
      } catch(fatalError) { console.error("Fatal Page Error:", fatalError); }
    </script>
  </body>
</html>